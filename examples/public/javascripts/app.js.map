{"version":3,"file":"public/javascripts/app.js","sources":["app/controllers/foo-controller.coffee","app/controllers/home-controller.coffee","app/initialize.coffee","app/lib/router.coffee"],"names":[],"mappings":"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","sourcesContent":["module.exports = class FooController extends Warden.Controller\n  beforeAction: (req) ->\n    layout = @reuse Layout\n\n  afterAction: (req) ->\n\n  index: ->\n    console.log 'foo'\n","module.exports = class HomeController extends Warden.Controller\n  beforeAction: (req) ->\n    layout = @reuse Layout\n    new Promise (done) =>\n      setTimeout =>\n        done()\n      , 1\n\n  afterAction: (req) ->\n\n  index: ->\n    homeView = @reuse HomeView\n    console.log 'home'\n","class window.Layout\n  dispose: ->\n    console.log 'Layout disposed'\nclass window.HomeView\n  dispose: ->\n    console.log 'HomeView disposed'\n\n$ ->\n  router = new Warden\n  router.match '', 'home#index'\n  router.match 'foo', 'foo#index'\n","\"use strict\"\n\nclass Warden\n  constructor: (opts) ->\n    @pushState = opts?.pushState ? false\n    throw 'Sorry, push state is not working yet' if @pushState is true\n\n    @events = {}\n    @params = []\n    @state = null\n    @version = '0.4.1'\n    @anchor =\n      defaultHash: window.location.hash\n      get: -> if window.location.hash then window.location.hash.split('#')[1] else ''\n      set: (anchor) ->\n        window.location.hash = if not anchor then '' else anchor\n        @\n      clear: -> @set(false)\n      reset : -> @set(@defaultHash)\n\n    if @pushState\n      debugger\n      if typeof window.onpopstate is 'function' then @on 'popstate', window.onpopstate\n      @ready = true\n      window.onpopstate = =>\n        if @ready\n          @ready = false\n          console.log 'popstate here'\n          @trigger('popstate')\n    else\n      if typeof window.onhashchange is 'function' then @on 'hashchange', window.onhashchange\n      window.addEventListener 'hashchange', => @trigger('hashchange')\n\n    @trigger('initialized')\n\n  trigger: (event) =>\n    params = Array.prototype.slice.call(arguments, 1)\n    if @events[event]\n      for key , fn of @events[event]\n        fn(params...)\n    @\n\n  get: (route, handler) =>\n    keys = []\n    regex = Warden.regexRoute route, keys\n\n    invoke = =>\n      match = @anchor.get().match(regex)\n      if match\n        event =\n          route: route\n          value: @anchor.get()\n          handler: handler\n          params: @params\n          regex: match\n          propagateEvent: true\n          previousState: @state\n          preventDefault: -> @propagateEvent = false\n        @trigger('match', event)\n        unless event.propagateEvent then return @\n        @state = event\n        req = params : {}, keys: keys, matches: event.regex.slice(1)\n        for key, val of req.matches\n          req.params[key] = if value then decodeURIComponent(value) else undefined;\n        handler.call(@, req, event)\n      @\n    invoke().on('initialized hashchange popstate', invoke)\n\n  on: (event, handler) ->\n    events = event.split(' ')\n    for event in events\n      if @events[event]\n        @events[event].push(handler)\n      else\n        @events[event] = [handler]\n    @\n\n  context: (context) =>\n    (value, callback) =>\n      prefix = if (context.slice(-1) isnt '/') then context + '/' else context\n      pattern = prefix + value\n      @get.call @, pattern, callback\n\n  @regexRoute: (path, keys, sensitive, strict) ->\n    if (path instanceof RegExp) then return path\n    if (path instanceof Array) then path = '(' + path.join('|') + ')'\n    path = path.concat(if strict then '' else '/?')\n      .replace(/\\/\\(/g, '(?:/')\n      .replace(/\\+/g, '__plus__')\n      .replace(/(\\/)?(\\.)?:(\\w+)(?:(\\(.*?\\)))?(\\?)?/g, (_, slash, format, key, capture, optional) ->\n          keys.push(name: key, optional: !!optional)\n          slash = slash or ''\n          '' + (if optional then '' else slash) + '(?:' + (if optional then slash else '') + (format or '') + (capture or (format and '([^/.]+?)' and '([^/]+?)')) + ')' + (optional or '')\n      )\n      .replace(/([\\/.])/g, '\\\\$1')\n      .replace(/__plus__/g, '(.+)')\n      .replace(/\\*/g, '(.*)');\n    new RegExp('^' + path + '$', if sensitive then '' else 'i')\n\n  findController: (controllerName) =>\n    require \"controllers/#{controllerName}-controller\"\n\n  @navigate: (path, pushState = false) =>\n    path = path.replace(/#|\\//, '')\n    if pushState\n      history.pushState {}, \"\", '/'+path\n    else\n      location.href = '#'+path\n\n  navigate: (path) =>\n    Warden.navigate(path, @pushState)\n\n  match: (route, requirement) =>\n    [controllerName, actionName] = requirement.split('#')\n    Controller = @findController controllerName\n\n    continueAnyway = (maybePromise, next) -> maybePromise?.then?(next) ? next()\n\n    action = (req) =>\n      lastController = @currentController ? {}\n      @currentController = new Controller {@pushState}\n      @currentController.setLastUsings (lastController.usings ? [])\n\n      continueAnyway @currentController.beforeAction(req), =>\n        continueAnyway @currentController[actionName](req), =>\n          @currentController.fix()\n          continueAnyway lastController.dispose?(), =>\n            continueAnyway @currentController.afterAction(req), =>\n              @ready = true\n\n    @get route, action\n\nfind = (list, fn) ->\n  for i in list\n    return i if fn(i)\n  null\n\nclass Warden.Controller\n  constructor: (opts) ->\n    @pushState = opts?.pushState ? false\n    @fixed = false\n    @lastUsings = []\n    @usings = []\n\n  setLastUsings: (@lastUsings) ->\n\n  reuse: (cls) =>\n    throw 'Post initialized reuse exception' if @fixed\n    throw 'not newable' unless cls.constructor\n\n    used = find @lastUsings, (used) -> used.constructor is cls\n    @usings.push (used ? new cls)\n\n  use: (cls) ->\n    @usings.push new cls\n\n  navigate: (path) =>\n    Warden.navigate(path, @pushState)\n\n  fix: ->\n    currentUsedList = []\n    for used in @lastUsings\n      alsoUsed = find @usings, (using) =>\n        using.constructor is used.constructor\n      unless alsoUsed\n        used.dispose()\n        @lastUsings.splice @lastUsings.indexOf(used), 1\n    @fixed = true\n    delete @lastUsings\n\n  dispose: =>\n    delete @usings\n\n  beforeAction: (req) ->\n\n  afterAction: (req) ->\n\nif 'function' is typeof window.define\n  window.define (require)-> Warden\nelse if 'object' is typeof exports\n  module.exports = Warden\nelse\n  window.Warden = Warden\n"]}